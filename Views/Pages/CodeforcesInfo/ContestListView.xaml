<UserControl x:Class="Tools.Views.Pages.CodeforcesInfo.ContestListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:models="clr-namespace:Tools.Models"
             xmlns:controls="clr-namespace:Tools.Controls"
             xmlns:converters="clr-namespace:Tools.Converters"
             xmlns:codeforcesInfoPage="clr-namespace:Tools.ViewModel.CodeforcesInfoPage"
             d:DataContext="{d:DesignInstance Type=codeforcesInfoPage:CodeforcesInfoViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="550"
             d:DesignWidth="692"
             ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
             ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}">
    <UserControl.Resources>
        <!-- 转换器 -->
        <converters:TimeSpanConverter x:Key="TimeSpanConverter" />
        <converters:PhaseToColorConverter x:Key="PhaseToColorConverter" />
        <converters:PhaseToIconConverter x:Key="PhaseToIconConverter" />
        <converters:PhaseToTextConverter x:Key="PhaseToTextConverter" />
        <converters:DateTimeConverter x:Key="DateTimeConverter" />
        <converters:ContestTypeToIconConverter x:Key="ContestTypeToIconConverter" />
        <converters:BooleanToVisibleConverter x:Key="BooleanToVisibleConverter" />
        <converters:StartTimeToTextConverter x:Key="StartTimeToTextConverter" />
        <converters:EndTimeToVisibleConverter x:Key="EndTimeToVisibleConverter" />
    </UserControl.Resources>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="60" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- 标题及工具栏 -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,16">
                <ui:SymbolIcon Symbol="Trophy16"
                               Filled="True"
                               FontSize="24"
                               Margin="0,0,12,0"
                               Foreground="#4CAF50" />

                <ui:TextBlock Text="{Binding ContestListTitle}"
                              FontTypography="Title"
                              VerticalAlignment="Center"
                              FontSize="24"
                              Foreground="#FFFFFF" />
            </StackPanel>
            <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,0,16">
                <ui:Button Icon="{ui:SymbolIcon Settings16, FontSize=22, Filled=True}"
                           Width="42"
                           Height="42"
                           Background="Transparent"
                           BorderBrush="Transparent"
                           IsEnabled="{Binding FinishedContestCodeLoading}"
                           Command="{Binding SettingContestsLoadTimeRangeCommand}"
                           Margin="5, 0" />

                <ui:Button Icon="{ui:SymbolIcon ArrowSync24, FontSize=22, Filled=True}"
                           Width="42"
                           Height="42"
                           Background="Transparent"
                           BorderBrush="Transparent"
                           IsEnabled="{Binding FinishedContestCodeLoading}"
                           Command="{Binding RefreshContestListCommand}"
                           Margin="5,0" />
            </StackPanel>
        </Grid>

        <!-- 加载中动画 -->
        <controls:LoadingBox Grid.Row="1" LoadingMessage="正在获取比赛列表..."
                             IsActive="{Binding IsContestsLoading}" />

        <!-- 主展示区 -->
        <ui:DynamicScrollViewer Grid.Row="1" MaxHeight="400" Margin="0,0,10,0"
                                Visibility="{Binding IsContestsLoading, Converter={StaticResource BooleanToVisibleConverter}, ConverterParameter=True}"
                                HorizontalAlignment="Stretch" VerticalAlignment="Top">
            <Grid>
                <!-- 主信息区 -->
                <Grid Margin="0,16,0,0"
                      Visibility="{Binding HasContestsError, Converter={StaticResource BooleanToVisibleConverter}, ConverterParameter=True}">
                    <ItemsControl ItemsSource="{Binding Contests}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type models:ContestModel}">
                                <ui:Border Background="#1E1E1E"
                                           CornerRadius="12"
                                           BorderThickness="1"
                                           BorderBrush="#333333"
                                           Margin="0,0,0,16"
                                           Padding="16">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <!-- 左侧比赛信息 -->
                                        <StackPanel Grid.Column="0">
                                            <!-- 比赛名称 -->
                                            <ui:TextBlock Text="{Binding Name}"
                                                          FontSize="16"
                                                          FontWeight="SemiBold"
                                                          Foreground="White"
                                                          TextWrapping="Wrap"
                                                          Margin="0,0,0,8" />

                                            <!-- 比赛类型和状态标签 -->
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <ui:Border Background="#333333"
                                                           CornerRadius="6"
                                                           Padding="6,4"
                                                           Margin="0,0,8,0">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon
                                                            Symbol="{Binding Type, Converter={StaticResource ContestTypeToIconConverter}}"
                                                            Width="16"
                                                            Height="16"
                                                            Margin="0,0,4,0"
                                                            Foreground="#FFFFFF" />
                                                        <ui:TextBlock Text="{Binding Type}"
                                                                      FontWeight="Bold"
                                                                      Foreground="#FFFFFF" />
                                                    </StackPanel>
                                                </ui:Border>

                                                <ui:Border CornerRadius="6"
                                                           Padding="6,4"
                                                           Margin="0,0,8,0"
                                                           Visibility="{Binding Frozen, Converter={StaticResource BooleanToVisibleConverter}, ConverterParameter=True}"
                                                           Background="{Binding Phase, Converter={StaticResource PhaseToColorConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon
                                                            Symbol="{Binding Phase, Converter={StaticResource PhaseToIconConverter}}"
                                                            Width="16"
                                                            Height="16"
                                                            Margin="0,0,4,0"
                                                            Foreground="#FFFFFF" />
                                                        <ui:TextBlock
                                                            Text="{Binding Phase, Converter={StaticResource PhaseToTextConverter}}"
                                                            FontWeight="Bold"
                                                            Foreground="#FFFFFF" />
                                                    </StackPanel>
                                                </ui:Border>

                                                <ui:Border Background="SkyBlue"
                                                           CornerRadius="6"
                                                           Padding="6,4"
                                                           Margin="0,0,8,0"
                                                           Visibility="{Binding Frozen, Converter={StaticResource BooleanToVisibleConverter}, ConverterParameter=False}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon
                                                            Symbol="LockClosed24"
                                                            Width="16"
                                                            Height="16"
                                                            Margin="0,0,4,0"
                                                            Foreground="#FFFFFF" />
                                                        <ui:TextBlock Text="赛后冻结中"
                                                                      FontWeight="Bold"
                                                                      Foreground="#FFFFFF" />
                                                    </StackPanel>
                                                </ui:Border>
                                            </StackPanel>

                                            <!-- 比赛详情网格 -->
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>

                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- 开始时间 -->
                                                <ui:TextBlock Grid.Row="0" Grid.Column="0"
                                                              Text="开始时间: "
                                                              FontSize="14"
                                                              Foreground="#AAAAAA"
                                                              Margin="0,0,0,4" />

                                                <ui:TextBlock Grid.Row="0" Grid.Column="1"
                                                              Text="{Binding StartTime, Converter={StaticResource DateTimeConverter}}"
                                                              FontSize="14"
                                                              Foreground="White"
                                                              Margin="0,0,0,4" />

                                                <!-- 持续时间 -->
                                                <ui:TextBlock Grid.Row="1" Grid.Column="0"
                                                              Text="持续时间: "
                                                              FontSize="14"
                                                              Foreground="#AAAAAA"
                                                              Margin="0,0,0,4" />

                                                <ui:TextBlock Grid.Row="1" Grid.Column="1"
                                                              Text="{Binding Duration, Converter={StaticResource TimeSpanConverter}, ConverterParameter=True}"
                                                              FontSize="14"
                                                              Foreground="White"
                                                              Margin="0,0,0,4" />

                                                <!-- 比赛ID -->
                                                <ui:TextBlock Grid.Row="2" Grid.Column="0"
                                                              Text="比赛ID: "
                                                              FontSize="14"
                                                              Foreground="#AAAAAA"
                                                              Margin="0,0,0,4" />

                                                <ui:TextBlock Grid.Row="2" Grid.Column="1"
                                                              Text="{Binding Id}"
                                                              FontSize="14"
                                                              Foreground="White"
                                                              Margin="0,0,0,4" />
                                            </Grid>

                                            <!-- 倒计时 -->
                                            <StackPanel Margin="0,12,0,0"
                                                        Visibility="{Binding EndTime, Converter={StaticResource EndTimeToVisibleConverter}}">
                                                <ui:TextBlock
                                                    FontSize="14"
                                                    Foreground="#AAAAAA"
                                                    Margin="0,0,0,4">
                                                    <ui:TextBlock.Text>
                                                        <MultiBinding
                                                            Converter="{StaticResource StartTimeToTextConverter}">
                                                            <Binding Path="StartTime" />
                                                            <Binding Path="EndTime" />
                                                        </MultiBinding>
                                                    </ui:TextBlock.Text>
                                                </ui:TextBlock>

                                                <ui:TextBlock
                                                    Text="{Binding Count, Converter={StaticResource TimeSpanConverter}}"
                                                    FontSize="20"
                                                    FontWeight="Bold"
                                                    Foreground="#4CAF50"
                                                    Margin="0,4,0,0" />
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- 右侧状态图标 -->
                                        <!-- 暂时作废 -->
                                    </Grid>
                                </ui:Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>

                <!-- 错误信息 -->
                <controls:ErrorBox IsActive="{Binding HasContestsError}"
                                   ErrorMessage="{Binding ContestsErrorMessage}" />
            </Grid>
        </ui:DynamicScrollViewer>
    </Grid>
</UserControl>